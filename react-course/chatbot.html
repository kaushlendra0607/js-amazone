<!DOCTYPE html>
<html>

<head>
    <title>Chatbot</title>
    <style>
        body{
            font-family: Arial, Helvetica, sans-serif;
            box-sizing: border-box;
            margin: 0 8px;
        }
        .send-button {
            background-color: rgb(25, 135, 84);
            /* width: 100px;
            height: 50px; */
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 15px;
            margin: 10px;
            color: white;
            box-sizing: border-box;
            border: none;
            cursor: pointer;
        }

        .chat-input {
            padding: 20px 14px;
            font-size: 14px;
            height: 36px;
            border: 2px solid #aaa;
            border-radius: 8px;
            box-sizing: border-box;
            outline: none;
            background-color: #fff;
            color: #333;
            transition: border 0.25s ease, box-shadow 0.25s ease;
            flex-grow: 1;
        }

        .chat-input::placeholder{
             color: #999;
        }
        .chat-input:focus {
            border: 2px solid transparent;
            background-origin: border-box;
            background-clip: padding-box, border-box;
            background-image:
                linear-gradient(#fff, #fff),
                linear-gradient(120deg, #ff00cc, #3333ff, #00ffff);
            animation: animated-outline 2s linear infinite;
            outline: none;
            background-size: 200% 200%;
            background-position: 0% 50%;
        }

        @keyframes animated-outline {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }
        .chat-input-container{
            display: flex;
            align-items: center;
            margin-bottom: 40px;
        }
        .app-container{
            max-width: 600px;
            margin: auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .chat-message-user{
            display: flex;
            justify-content: end;
            align-items: center;
        }
        .chat-message-robot{
            display: flex;
            align-items: center;
        }
        .chat-message-text{
            background-color: rgb(232, 232, 232);
            padding: 15px 20px;
            margin: 10px 10px;
            border-radius: 10px;
            max-width: 300px;
        }
        .chat-message-profile{
            width:45px;
        }
        .chat-messages-container{
            flex-grow: 1;
            margin-top: 20px;
            overflow: scroll;
            scrollbar-width: none;
        }
        
    </style>
</head>

<body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        function ChatInput({ chatMessages, setChatMessages }) {//now we can access this state
            const [inputText, setInputText] = React.useState('');
            function saveInputText(event) {//event is an object which contains the properties of       onchange element.
                setInputText(event.target.value);
            }

            function sendMessage() {
                const newChatMessages = [
                    ...chatMessages,//syntax of spread oprtr
                    {//this the new data to be updated
                        message: inputText,
                        sender: "user",
                        id: crypto.randomUUID()
                    }
                ]
                setChatMessages(newChatMessages);

                const response = Chatbot.getResponse(inputText);
                setChatMessages([
                    ...newChatMessages,//syntax of spread oprtr
                    {//this the new data to be updated
                        message: response,
                        sender: "robot",
                        id: crypto.randomUUID()
                    }
                ]);

                setInputText('');

            }

            return (
                <div className="chat-input-container">
                    <input
                        type="text"
                        placeholder="Send message to Chatbot"
                        onChange={saveInputText}
                        value={inputText}
                        className="chat-input"
                    />
                    <button onClick={sendMessage} className="send-button">Send</button>
                </div>
            );
        }
        function ChatMessage({ message, sender }) {
            //const message = props.message;
            //const sender=props.sender;
            //const {message,sender}=props;
            /*
            if(sender === "robot"){
                return (
                    <div>
                        <img src="robot.png" alt="robot" width="50" />
                        {message}
                    </div>
                );
            }*/
            return (
                <div className={sender === "user" ? "chat-message-user":"chat-message-robot"}>
                    {sender === "robot" && <img src="robot.png" alt="robot" className="chat-message-profile" />}
                    <div className="chat-message-text">
                       {message}
                    </div>
                    {sender === "user" && <img src="user.png" alt="user" className="chat-message-profile"/>}
                </div>
            );
        }

        function ChatMessages({ chatMessages }) {//using state will change the html as well when the data changes.
            // const chatMessages = array[0];//array[0] gives the current data from state.
            // const setChatMessages = array[1];//this is actually a function and has to be treated xactly like a funcn. this updates the data in future.
            // const [ chatMessages, setChatMessages] = array;//shortcut for above two lines(order matters of chatMessages and setChatMessages)on useState line shortest method is used for destructuring.

            /* function sendMessage(){
                 chatMessages.push({
                     message:"test",
                     sender:"user",
                     id:crypto.randomUUID()
                 });
                 console.log(chatMessages);
                 the above method is modifying the data directly.Not good practice 
                 we shuld modify the copy of  the data.Use useState...
                  }*/
            const chatMessagesRef=React.useRef(null);//useRef lets us save an html element ,basically works like queryselector
            React.useEffect(()=>{//useEffect lets us run some code after a component is created or updated
            const containerElem = chatMessagesRef.current;
            if(containerElem){
                containerElem.scrollTop=containerElem.scrollHeight;
                //scrollTop is how far is scroll from the top and scrollHeight is total scroling height of the element so if we set the scrollTop equal to Height then it will get on bottom...
            }
               
            },[chatMessages]);
            return (
                <div className="chat-messages-container"
                ref={chatMessagesRef}
                >
                    {
                        chatMessages.map((chatMessage) => {
                            return (
                                <ChatMessage
                                    message={chatMessage.message}
                                    sender={chatMessage.sender}
                                    key={chatMessage.id}
                                />
                            );
                        })
                    }
                </div>
            );
        }

        function App() {
            const [chatMessages, setChatMessages] = React.useState(
                [
                    {
                        message: " hello sir..",
                        sender: "user",
                        id: "id1"
                    }, {
                        message: "Hello! How can I help you?",
                        sender: "robot",
                        id: "id2"
                    }, {
                        message: "flip a damn coin",
                        sender: "user",
                        id: "id3"
                    }, {
                        message: "Sure! You got heads",
                        sender: "robot",
                        id: "id4"
                    }
                ]
            );
            //we removed above code from ChatMessages funcn to its parent component i.e. App this makes the availability of state to all the child component of App nad this process is called lifting the state up
            return (
                <div className="app-container">{/*Here we now add some props (attributes) to our created element ChatInput */}
                    
                    <ChatMessages chatMessages={chatMessages} />
                    {/*we generally use same name*/}
                    <ChatInput
                        chatMessages={chatMessages}
                        setChatMessages={setChatMessages}
                    />
                </div>
            );
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>

</html>